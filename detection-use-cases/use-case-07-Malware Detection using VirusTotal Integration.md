## UC7 – Malware Detection using VirusTotal Integration (Ubuntu Agent)

### Objective
Detect and analyze malicious files on an Ubuntu Linux system using Wazuh malware detection integrated with VirusTotal threat intelligence. This use case demonstrates how SOC teams validate suspicious files using external threat intelligence to confirm malware presence.

---

### Environment
- **Monitored Host:** Ubuntu Linux (Wazuh Agent)
- **SIEM Platform:** Wazuh
- **Threat Intelligence:** VirusTotal Integration
- **Detection Type:** Host-based (File Analysis)
- **Malware Simulation:** EICAR Test File (Safe, Non-Malicious)

---

### SOC Context
Malware detection is a critical SOC function for identifying infected systems and preventing further compromise. Integrating SIEM alerts with threat intelligence platforms such as VirusTotal allows SOC analysts to validate suspicious files, reduce false positives, and make informed response decisions.

---

### Step 1: VirusTotal Integration Configuration
- VirusTotal API integration is enabled in Wazuh.
- Wazuh is configured to submit file hashes to VirusTotal.
- API connectivity between Wazuh and VirusTotal is verified.
- Malware detection rules are enabled.

---

### Step 2: Malware Simulation (Controlled Lab Scenario)
- A standard EICAR test file is created on the Ubuntu system.
- The EICAR file is a harmless test string designed to simulate malware detection.
- The file is placed in a monitored directory to trigger detection.

---

### Step 3: Detection and Alert Generation
- Wazuh detects the presence of a suspicious file.
- The file hash is generated and submitted to VirusTotal.
- VirusTotal returns threat intelligence results based on multiple antivirus engines.
- Wazuh generates an alert containing:
  - File name and path
  - File hash (SHA256/MD5)
  - VirusTotal detection score
  - Alert severity
  - Rule ID and timestamp

---

### Step 4: Alert Visibility
- Malware detection alerts are displayed in the Wazuh Dashboard.
- VirusTotal results are visible as part of the alert details.
- Alerts with positive detection scores are prioritized for investigation.

---

### Step 5: SOC Investigation
The SOC analyst investigates:
- **What was detected:** Suspicious or malicious file
- **Where it was found:** File path on Ubuntu system
- **Threat confidence:** VirusTotal detection ratio
- **Context:** Whether the file is expected or unauthorized
- **Correlation:** Presence of related alerts such as command execution or file modifications

---

### Response Actions (Simulated)
- The detected file is flagged as malicious.
- The file is quarantined or removed (simulated).
- The affected system is monitored for additional malicious activity.
- Incident details are documented according to SOC procedures.

---

### Evidence to Collect
- Screenshot of malware alert in the Wazuh Dashboard
- File name and file path
- File hash value
- VirusTotal detection score
- Alert severity and timestamp

---

### MITRE ATT&CK Mapping
- **Tactic: TA0002 – Execution**
- **Technique ID: T1203**
- **Technique Name: Exploitation for Client Execution** 

---

### SOC Relevance
This use case demonstrates the SOC’s ability to detect suspicious files, enrich alerts with threat intelligence, validate malware using VirusTotal, and make informed response decisions to protect Linux systems from malware threats.
